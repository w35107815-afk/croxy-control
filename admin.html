<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Croxy Control Panel</title>
<style>
body{
  font-family:sans-serif;
  max-width:700px;
  margin:40px auto;
}
.row{
  display:flex;
  justify-content:space-between;
  padding:8px;
  border-bottom:1px solid #ddd;
}
button{
  padding:6px 12px;
  font-size:14px;
}
.save{
  margin-top:20px;
  font-size:16px;
  padding:10px 20px;
}
</style>
</head>

<body>

<h2>CroxyProxy 管理画面</h2>

<div id="list">読み込み中...</div>

<button class="save" onclick="save()">保存（JSONコピー）</button>

<script>
const CONTROL_URL="./control.json";
let data={devices:{}};

async function load(){
  try{
    const res=await fetch(CONTROL_URL+"?t="+Date.now());
    data=await res.json();

    const list=document.getElementById("list");
    list.innerHTML="";

    Object.keys(data.devices).forEach(id=>{
      const row=document.createElement("div");
      row.className="row";

      const label=document.createElement("span");
      label.textContent=id;

      const btn=document.createElement("button");
      btn.textContent=data.devices[id]?"ON":"OFF";

      btn.onclick=()=>{
        data.devices[id]=!data.devices[id];
        btn.textContent=data.devices[id]?"ON":"OFF";
      };

      row.appendChild(label);
      row.appendChild(btn);
      list.appendChild(row);
    });

  }catch(e){
    document.getElementById("list").textContent="control.json を読み込めません";
    console.error(e);
  }
}

function save(){
  const text=JSON.stringify(data,null,2);
  console.log(text);
  prompt("このJSONをコピーして GitHub の control.json に貼り付けて保存してください",text);
}

load();
</script>

</body>
</html>

